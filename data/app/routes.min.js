var userController=require("./controllers/userController"),voteController=require("./controllers/voteController");module.exports=function(e){io.sockets.on("connection",function(e){e.on("ready",function(){userController.getTopUsers(function(t,n){if(t)return e.emit("TopUserResponse",t);e.emit("TopUserResponse",n)})})});e.post("/login/",function(e,t,n){e.assert("FirstName","First Name required").notEmpty();e.assert("LastName","Last Name required").notEmpty();e.assert("Email","Email required").notEmpty();e.assert("Email","Invalid email").isEmail();var r=e.validationErrors(!0);if(r)return n({name:"Validation Error",message:"There have been validation errors",errors:r});userController.isUserAuthenticated(e.body.FirstName,e.body.LastName,function(r,i){if(r)return n(r);userController.setUserAuthenticated(e.body.Email,i.userID,function(e,r){if(e)return n(e);t.send(i)})})});e.post("/vote/",function(e,t,n){voteController.storeUserVote(e.body.PollData,e.body.UserID,function(r,i){if(r)return n(r);userController.getUserResult(e.body.UserID,function(e,r){if(e)return n(e);t.send(r)})})});e.get("/leaderboard/",function(e,t){t.sendFile("/public/leaderboard.html",{root:__dirname+"/../"})});e.get("*",function(e,t){t.sendFile("/public/index.html",{root:__dirname+"/../"})})};